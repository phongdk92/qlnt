{% extends "base.html" %}

{% block content %}
{% if message != None %}
	{{message}} <br>
{% endif %}

<script>
    $(document).ready(function() {
        {% if pos > 3 %}
            $("input").attr("disabled",false);
            $("select").attr("disabled",false);
        {% endif %}
        {% if pos == 3 %}
            $("input","#tabs2").attr("disabled",false);
            $("select","#tabs2").attr("disabled",false);
        {% endif %}
        $( "#tabs" ).tabs({
            ajaxOptions: {
                error: function( xhr, status, index, anchor ) {
                    $( anchor.hash ).html(
                        "Có lỗi khi lấy dữ liệu từ máy chủ. Xin hãy thử lại" );
                },
                global: false
            }
        });
        var update_teacher_detail = function(json) {
            $("#notify").showNotification(json.message);
            if (json.response_type == 'ttcn') {
                $("#id_first_name").parents("td").append(json.first_name);
                $("#id_last_name").parents("td").append(json.last_name);
                $("#id_birthday").parents("td").append(json.birthday);
            }
            else if (json.response_type == 'ttll') {
                $("#id_phone").parents("td").append(json.phone);
                $("#id_email").parents("td").append(json.email);
                $("#id_sms_phone").parents("td").append(json.sms_phone);
            }
        };
        $("form").submit(function(){
            $(".errorlist", this).empty();
            data = $(this).serialize();
            var arg = {
                data : data,
                type: $(this).attr("method"),
                url: $(this).attr("action"),
                success: update_teacher_detail,
                global: false
            };
            $.ajax(arg);
            return false;
        });
    });
</script>
<div id="tabs">
    <ul>
        <li><a href="#tabs1"> Thông tin cá nhân </a></li>
        <li><a href="#tabs2"> Thông tin liên lạc </a> </li>
        <li><a href="/school/teacher/account/{{ id }}">Tài khoản</a></li>
    </ul>
    <div id="tabs1">
        <form action="/school/viewTeacherDetail/{{id}}" method="post">{% csrf_token %}
            {{ ttcnform.non_field_errors }}
            <table class="styleA">
                {{ ttcnform.as_table }}
            </table>
            <input type="hidden" value="ttcn" name="request_type">
            {%if pos > 3%}
                <input type ="submit" class="ggButton"  value="Lưu"/>
            {% endif %}
            <a title="Hủy cập nhật và quay về danh sách giáo viên" href="{%url school.views.school_index  %}teachers" class="ggButton">Quay lại</a>
        </form>
    </div>
    <div id="tabs2">
        <form action="/school/viewTeacherDetail/{{id}}" method="post">{% csrf_token %}
            {{ ttllform.non_field_errors }}
            <table class="styleA">
                {{ ttllform.as_table }}
            </table>
            <input type="hidden" value="ttll" name="request_type">
            {%if pos > 2%}
                <input type ="submit" class="ggButton"  value="Lưu"/>
            {% endif %}
            <a title="Hủy cập nhật và quay về danh sách giáo viên" href="{%url school.views.school_index  %}teachers" class="ggButton">Quay lại</a>
        </form>
    </div>
</div>
{% endblock %}
