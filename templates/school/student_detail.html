{% extends "base.html" %}

{% block backward_link %}
<a href="{% url school.views.school_index %}classes"> Toàn trường</a> > <a href="{% url school.views.school_index %}viewClassDetail/{{ class.id }}"> {{ class }} </a> > {{ student }}
{% endblock %}

{% block content %}
  <script>
	$(document).ready(function() {
        $( "#tabs" ).tabs({
            ajaxOptions: {
                error: function( xhr, status, index, anchor ) {
                    $( anchor.hash ).html(
                        "Có lỗi khi lấy dữ liệu từ máy chủ. Xin hãy thử lại" );
                },
                global: false
            }
        });
        {% if pos > 3 %}
            $("input").attr('disabled',false);
            $("select").attr('disabled',false);
        {% endif %}
        $("#id_father_name").each(function(){
             if ($(this).val() == ''){
                $("#id_father_birthday").attr('disabled', true);
                $("#id_father_job").attr('disabled', true);
            }
        });

        $("#id_mother_name").each(function(){
            if ($(this).val() == ''){
                $("#id_mother_birthday").attr('disabled', true);
                $("#id_mother_job").attr('disabled', true);
            }
        });
        $("#id_father_name").change(function(){
            if ($(this).val() == ''){
                $("#id_father_birthday").val('');
                $("#id_father_job").val('');
                $("#id_father_birthday").attr('disabled', true);
                $("#id_father_job").attr('disabled', true);
            }
            else{
                $("#id_father_birthday").removeAttr('disabled');
                $("#id_father_job").removeAttr('disabled');
            }
        });

        $("#id_mother_name").change(function(){
            if ($(this).val() == ''){
                $("#id_mother_birthday").val('');
                $("#id_mother_job").val('');
                $("#id_mother_birthday").attr('disabled', true);
                $("#id_mother_job").attr('disabled', true);
            }
            else{
                $("#id_mother_birthday").removeAttr('disabled');
                $("#id_mother_job").removeAttr('disabled');
            }
        });

        $("#id_ngay_vao_doi").each(function(){
            if (!$("#id_doi").is(':checked')){
                $(this).attr('disabled', true);
            }
        });

        $("#id_ngay_vao_doan").each(function(){
            if (!$("#id_doan").is(':checked')){
                $(this).attr('disabled', true);
            }
        });

        $("#id_ngay_vao_dang").each(function(){
            if (!$("#id_dang").is(':checked')){
                $(this).attr('disabled', true);
            }
        });

        $("#id_doi").click(function() {
            if (!$(this).is(':checked')){
                $("#id_ngay_vao_doi").val('');
                $("#id_ngay_vao_doi").attr('disabled', true);
            }
            else{
                $("#id_ngay_vao_doi").removeAttr('disabled');
            }
        });

        $("#id_doan").click(function() {
            if (!$(this).is(':checked')){
                $("#id_ngay_vao_doan").val('');
                $("#id_ngay_vao_doan").attr('disabled', true);
            }
            else{
                $("#id_ngay_vao_doan").removeAttr('disabled');
            }
        });

        $("#id_dang").click(function() {
            if (!$(this).is(':checked')){
                $("#id_ngay_vao_dang").val('');
                $("#id_ngay_vao_dang").attr('disabled', true);
            }
            else{
                $("#id_ngay_vao_dang").removeAttr('disabled');
            }
        });
        var update_student_detail = function(json) {
            $("#notify").showNotification(json.message);
            if (json.response_type == 'ttcn') {
                $("#id_first_name").parents("td").append(json.first_name);
                $("#id_last_name").parents("td").append(json.last_name);
                $("#id_birthday").parents("td").append(json.birthday);
                $("#id_school_join_date").parents("td").append(json.school_join_date);
                $("#id_school_join_mark").parents("td").append(json.school_join_mark);
            }
            else if (json.response_type == 'ttgd') {
                $("#id_father_birthday").parents("td").append(json.father_birthday);
                $("#id_mother_birthday").parents("td").append(json.mother_birthday);
            }
            else if (json.response_type == 'ttll') {
                $("#id_phone").parents("td").append(json.phone);
                $("#id_father_phone").parents("td").append(json.father_phone);
                $("#id_mother_phone").parents("td").append(json.mother_phone);
                $("#id_email").parents("td").append(json.email);
                $("#id_sms_phone").parents("td").append(json.sms_phone);
            }
            else if (json.response_type == 'ttdd') {
                $("#id_ngay_vao_dang").parents("td").append(json.ngay_vao_dang);
                $("#id_ngay_vao_doi").parents("td").append(json.ngay_vao_doi);
                $("#id_ngay_vao_doan").parents("td").append(json.ngay_vao_doan);
            }
        };
        $("form.student_detail").submit(function() {
            $(".errorlist", this).empty();
            data = $(this).serialize();
            var arg = {
                data : data,
                type: $(this).attr("method"),
                url: $(this).attr("action"),
                success: update_student_detail,
                global: false
            };
            $.ajax(arg);
            return false;
        });
        $("a.onPage").live("click", function() {
            $.ajax({
                url: this.href,
                global: false,
                dataType: 'html',
                type: 'GET',
                success: function(response){
                    $('.ui-tabs-panel:visible').html(response);
                    applyListener();
                }
            });
            return false;
        });
        $("form.onPage").live("submit", function() {
            var data = $(this).serialize();
            var arg = {
                data:data,
                type: $(this).attr("method"),
                url: $(this).attr("action"),
                global: false,
                success: function(response){
                    $('.ui-tabs-panel:visible').html(response);
                    applyListener();
                }
            };
            $.ajax(arg);
            return false;
        });
    });
</script>

{%if pos > 0%}

{%endif%}

{% if message != None %}
	{{message}} <br>
{% endif %}

<h2> Học sinh {{ student }}</h2>

<div id="tableFunction">
<a title="Danh sách lớp học" class = "tiptiphove ggButton" href="{%url school.views.school_index  %}viewClassDetail/{{class.id}}">Quay lại</a>
</div>

    <div id = "tabs">
        <ul>
            <li><a href="#tabs-1">Thông tin cá nhân</a></li>
            <li><a href="#tabs-2">Liên lạc</a></li>
            <li><a href="#tabs-3">Gia đình</a></li>
            <li><a href="#tabs-4">Đoàn/đội</a></li>
            <li><a href="/school/khenthuong/{{id}}">Khen thưởng</a></li>
            <li><a href="/school/kiluat/{{id}}">Kỉ luật</a></li>
            <li><a href="/school/diemdanhhs/{{id}}">Nghỉ học</a></li>
            <li><a href="{%url school.views.school_index  %}markForAStudent/{{class.id}}/{{id}}">Điểm</a></li>
			<li><a title="Cập nhập miễn giảm"  href="/school/capNhapMienGiam/{{class.id}}/{{id}}">Miễn giảm</a> </li>
            {% if pos > 3 %}
                <li><a href="/school/student/account/{{ id }}">Tài khoản</a> </li>
            {% endif %}
        </ul>
        <div id = "tabs-1">
            <form action="/school/viewStudentDetail/{{id}}" method="post" class="student_detail">{% csrf_token %}
                <table class = "styleA" >
                {{ ttcnform.as_table }}
                </table>
                {% if pos > 3 %}
                    <input type="hidden" name="request_type" value="ttcn">
                    <input class="ggButton" type="submit" value="Lưu"/>
                {% endif %}
            </form>
        </div>
        <div id = "tabs-2">
            <form action="/school/viewStudentDetail/{{id}}" method="post" class="student_detail ttll">{% csrf_token %}
                <table class = "styleA">
                {{ ttllform.as_table }}
                </table>
                {% if pos > 3 or pos == 1 %}
                    <input type="hidden" name="request_type" value="ttll">
                    <input class="ggButton" type="submit" value="Lưu"/>
                {% endif %}
            </form>
        </div>
        <div id = "tabs-3">
            <form action="/school/viewStudentDetail/{{id}}" method="post" class="student_detail">{% csrf_token %}
                <table class = "styleA">
                {{ ttgdform.as_table }}
                </table>
                {% if pos > 3 %}
                    <input type="hidden" name="request_type" value="ttgd">
                    <input class="ggButton" type="submit" value="Lưu"/>
                {% endif %}
            </form>
        </div>
        <div id = "tabs-4">
            <form action="/school/viewStudentDetail/{{id}}" method="post" class="student_detail">{% csrf_token %}
                <table class = "styleA">
                {{ ttddform.as_table }}
                </table>
                {% if pos > 3 %}
                    <input type="hidden" name="request_type" value="ttdd">
                    <input class="ggButton" type="submit" value="Lưu"/>
                {% endif %}
            </form>
        </div>
    </div>
{% endblock %}
